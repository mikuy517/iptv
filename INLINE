const videos = [{
    manifestUri: 'https://linearjitp-playback.astro.com.my/dash-wv/linear/2304/default.mpd',
    clearKey: {
        'a098896d2b11c5f3906a993c3ba5c610': 'f3f842c54cc96cbbd0bcb96a4cb8a813'
    }
}, {
    manifestUri: 'https://linearjitp-playback.astro.com.my/dash-wv/linear/5055/default.mpd',
    clearKey: {
        '5d600eb70944d681c26c1f48fbe61f10': '796139ba05a2ab425f978c7fd98b4372'
    }
}, {
    manifestUri: 'https://qp-pldt-live-grp-03-prod.akamaized.net/out/u/cg_hbofam.mpd',
    clearKey: {
        '872910c843294319800d85f9a0940607': 'f79fd895b79c590708cf5e8b5c6263be'
    }
}, {
    manifestUri: 'https://qp-pldt-live-grp-01-prod.akamaized.net/out/u/cg_hbosign.mpd',
    clearKey: {
        'a06ca6c275744151895762e0346380f5': '559da1b63eec77b5a942018f14d3f56f'
    }
}, {
    manifestUri: 'https://linearjitp-playback.astro.com.my/dash-wv/linear/603/default.mpd',
    clearKey: {
        'efdb2a8d39151cc39f4b51d762cf9c10': '13cc535ad4a73201147863cac386cdd3'
    }
}, {
    manifestUri: 'https://linearjitp-playback.astro.com.my/dash-wv/linear/5095/default.mpd',
    clearKey: {
        'b5bfe3554df2abcd37afe130a7e1d310': 'dccbdf043ac43d18be0b3eb43a582876'
    }
}, {
    manifestUri: 'https://linearjitp-playback.astro.com.my/dash-wv/linear/2605/default.mpd',
    clearKey: {
        '6093e12639b24cd651ee6b3c13446d10': 'f8326f668c7bee309e5302b513e5bdf7'
    }
}, ];

async function loadVideo(index) {
    const player = window.player;
    const {
        manifestUri,
        clearKey
    } = videos[index];
    console.log('Loading video:', manifestUri);

    player.configure({
        drm: {
            clearKeys: clearKey
        }
    });

    try {
        await player.load(manifestUri);
        console.log('Video loaded successfully!');
    } catch (error) {
        console.error('Error loading video:', error);
    }
}

function initApp() {
    shaka.polyfill.installAll();
    if (shaka.Player.isBrowserSupported()) {
        init();
    } else {
        console.error('Browser not supported!');
    }
}

async function init() {
    const video = document.getElementById('video');
    const ui = video['ui'];
    const controls = ui.getControls();
    const player = controls.getPlayer();
    const config = {
        'seekBarColors': {
            base: 'rgba(255, 255, 255, 0.3)',
            buffered: 'rgba(255, 255, 255, 0.54)',
            played: 'rgb(255, 255, 255)'
        }
    };

    player.configure({
        drm: {
            clearKeys: videos[0].clearKey
        }
    });

    ui.configure(config);
    window.player = player;
    window.ui = ui;
    window.controls = controls;
    player.addEventListener("error", onPlayerErrorEvent);
    controls.addEventListener("error", onUIErrorEvent);

    try {
        await player.load(videos[0].manifestUri);
        console.log('The video has now been loaded!');
    } catch (error) {
        console.error('Error loading video:', error);
    }
}

function onPlayerErrorEvent(errorEvent) {
    console.error('Player error:', errorEvent.detail);
}

function onUIErrorEvent(errorEvent) {
    console.error('UI error:', errorEvent.detail);
}

document.addEventListener('shaka-ui-loaded', init);
document.addEventListener('shaka-ui-load-failed', initFailed);
document.addEventListener('DOMContentLoaded', initApp);

function initFailed() {
    console.error('Shaka UI failed to load');
}

Object.defineProperty(navigator, 'userAgent', {
    get: function() {
        return 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.4044.138 Safari/537.36';
    }
});
